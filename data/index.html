<!doctype html>
<html lang="ja">
  <head>
    <meta http-equiv="refresh" content="300">
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <title>My Aquarium Status</title>
  </head>
  <body>
	<nav class="navbar navbar-dark bg-dark navbar-expand-lg">
		<a href="#" class="navbar-brand">My Aquarium</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarNav">
			<ul class="navbar-nav">
				<li class="nav-item active">
					<a class="nav-link" href="#">Home</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="#Status">Status</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="#Settings">Settings</a>
				</li>
			</ul>
		</div>
	</nav>
    <a name="Status"></a>
    <h1>Status</h1>
    <h6>Updated at %whenupdated%</h6>
    <table class="table table-striped">
    	<tr><th>Parameter</th><th>Value</th><th>Unit</th></tr>
    	<tr><td>水温</td><td>%wtemp%</td><td>℃</td></tr>
    	<tr><td>室温</td><td>%rtemp%</td><td>℃</td></tr>
    	<tr><td>湿度</td><td>%rhumid%</td><td>％</td></tr>
    	<tr><td>サーミスタ</td><td>%wtempR%</td><td>Ω</td></tr>
    </table>
    <table class="table table-striped">
    	<tr>
    		<th>Device</th>
    		<th>ON/OFF</th>
    		<th>設定条件</th>
    	</tr>
    	<tr>
    		<td>LED</td>
    		<td>%st_led%</td>
    		<td>%tm_led_on% ～ %tm_led_off%</td>
    	</tr>
    	<tr>
    		<td>CO2</td>
    		<td>%st_co2%</td>
    		<td>%tm_co2_on% ～ %tm_co2_off%</td>
    	</tr>
    	<tr>
    		<td>BukuBuku</td>
    		<td>%st_bukubuku%</td>
    		<td>%tm_bukubuku_on% ～ %tm_bukubuku_off%</td>
    	</tr>
    	<tr>
    		<td>CoolingFan</td>
    		<td>%st_coolingfan%</td>
    		<td>ON:%CoolingFANThres_on%, OFF:%CoolingFANThres_off%</td>
    	</tr>
    	<tr>
    		<td>AC</td>
    		<td>%st_ac%</td>
    		<td>ON:%acThres_on%</td>
    	</tr>
    </table>
    
    <a name="Settings"></a>
    <h1>Settings</h1>
    
    <form id="form_config">
    	<h5>LED</h5>
    	<div>
    		<div class="form-check form-check-inline">
    			<input class="form-check-input" type="radio" name="md_led" id="md_led_forcedon" value="forcedon" %md_led_forcedonc%>
    			<label class="form-check-label" for="md_led_forcedon">強制ON</label>
    		</div>
    		<div class="form-check form-check-inline">
    			<input class="form-check-input" type="radio" name="md_led" id="md_led_forcedoff" value="forcedoff" %md_led_forcedoffc%>
    			<label class="form-check-label" for="md_led_forcedoff">強制OFF</label>
    		</div>
    		<div class="form-check form-check-inline">
    			<input class="form-check-input" type="radio" name="md_led" id="md_led_scheduled" value="scheduled" %md_led_scheduledc%>
    			<label class="form-check-label" for="md_led_scheduled">スケジュール動作</label>
    		</div>
    	</div>
    	<div class="form-group row">
    		<div class="col-auto">
	    		<label for="tm_led_on">Time ON</label>
	    		<input type="time" name="tm_led_on" id="tm_led_on" class="form-control" step="1" value="%tm_led_on%">
			</div>
			<div class="col-auto">
	    		<label for="tm_led_off">Time OFF</label>
	    		<input type="time" name="tm_led_off" id="tm_led_off" class="form-control" step="1" value="%tm_led_off%">
	    	</div>
    	</div>
    	<h5>CO2</h5>
    	<div>
    		<div class="form-check form-check-inline">
    			<input class="form-check-input" type="radio" name="md_co2" id="md_co2_forcedon" value="forcedon" %md_co2_forcedonc%>
    			<label class="form-check-label" for="md_co2_forcedon">強制ON</label>
    		</div>
    		<div class="form-check form-check-inline">
    			<input class="form-check-input" type="radio" name="md_co2" id="md_co2_forcedoff" value="forcedoff" %md_co2_forcedoffc%>
    			<label class="form-check-label" for="md_co2_forcedoff">強制OFF</label>
    		</div>
    		<div class="form-check form-check-inline">
    			<input class="form-check-input" type="radio" name="md_co2" id="md_co2_scheduled" value="scheduled" %md_co2_scheduledc%>
    			<label class="form-check-label" for="md_co2_scheduled">スケジュール動作</label>
    		</div>
    	</div>
    	<div class="form-group row">
    		<div class="col-auto">
    			<label for="tm_co2_on">Time ON</label>
    			<input type="time" name="tm_co2_on" id="tm_co2_on" class="form-control" step="1" value="%tm_co2_on%">
			</div>
			<div class="col-auto">
    			<label for="tm_co2_off">Time OFF</label>
    			<input type="time" name="tm_co2_off" id="tm_co2_off" class="form-control" step="1" value="%tm_co2_off%">
    		</div>
    	</div>
    	<h5>BukuBuku</h5>
    	<div>
    		<div class="form-check form-check-inline">
    			<input class="form-check-input" type="radio" name="md_bukubuku" id="md_bukubuku_forcedon" value="forcedon" %md_bukubuku_forcedonc%>
    			<label class="form-check-label" for="md_bukubuku_forcedon">強制ON</label>
    		</div>
    		<div class="form-check form-check-inline">
    			<input class="form-check-input" type="radio" name="md_bukubuku" id="md_bukubuku_forcedoff" value="forcedoff" %md_bukubuku_forcedoffc%>
    			<label class="form-check-label" for="md_bukubuku_forcedoff">強制OFF</label>
    		</div>
    		<div class="form-check form-check-inline">
    			<input class="form-check-input" type="radio" name="md_bukubuku" id="md_bukubuku_scheduled" value="scheduled" %md_bukubuku_scheduledc%>
    			<label class="form-check-label" for="md_bukubuku_scheduled">スケジュール動作</label>
    		</div>
    	</div>
    	<div class="form-group row">
    		<div class="col-auto">
    			<label for="tm_bukubuku_on">Time ON</label>
    			<input type="time" name="tm_bukubuku_on" id="tm_bukubuku_on" class="form-control" step="1" value="%tm_bukubuku_on%">
			</div>
			<div class="col-auto">
    			<label for="tm_co2_off">Time OFF</label>
    			<input type="time" name="tm_bukubuku_off" id="tm_bukubuku_off" class="form-control" step="1" value="%tm_bukubuku_off%">
    		</div>
    	</div>
    	<h5>CoolingFAN</h5>
    	<div>
    		<div class="form-check form-check-inline">
    			<input class="form-check-input" type="radio" name="md_CoolingFAN" id="md_CoolingFAN_forcedon" value="forcedon" %md_CoolingFAN_forcedonc%>
    			<label class="form-check-label" for="md_CoolingFAN_forcedon">強制ON</label>
    		</div>
    		<div class="form-check form-check-inline">
    			<input class="form-check-input" type="radio" name="md_CoolingFAN" id="md_CoolingFAN_forcedoff" value="forcedoff" %md_CoolingFAN_forcedoffc%>
    			<label class="form-check-label" for="md_CoolingFAN_forcedoff">強制OFF</label>
    		</div>
    		<div class="form-check form-check-inline">
    			<input class="form-check-input" type="radio" name="md_CoolingFAN" id="md_CoolingFAN_scheduled" value="scheduled" %md_CoolingFAN_scheduledc%>
    			<label class="form-check-label" for="md_CoolingFAN_scheduled">スケジュール動作</label>
    		</div>
    	</div>
    	<div class="form-group row">
    		<div class="col-auto">
    			<label for="CoolingFANThres_on">℃ ON</label>
    			<input type="number" name="CoolingFANThres_on" id="CoolingFANThres_on" class="form-control" step="0.5" min="10" max="40" value="%CoolingFANThres_on%">
			</div>
			<div class="col-auto">
    			<label for="CoolingFANThres_off">℃ OFF</label>
    			<input type="number" name="CoolingFANThres_off" id="CoolingFANThres_off" class="form-control" step="0.5" min="10" max="40" value="%CoolingFANThres_off%">
    		</div>
    	</div>
    	<h5>エアコン</h5>
    	<div>
    		<div class="form-check form-check-inline">
    			<input class="form-check-input" type="checkbox" name="acon" id="acon">
    			<label class="form-check-label" for="acon">ON NOW</label>
    		</div>
    		<div class="form-check form-check-inline">
    			<input class="form-check-input" type="checkbox" name="md_ac_scheduled" id="md_ac_scheduled" %md_ac_scheduledc%>
    			<label class="form-check-label" for="md_ac_scheduled">スケジュール動作</label>
    		</div>
    	</div>
    	<div class="form-group row">
    		<div class="col-auto">
    			<label for="acThres_on">℃ ON</label>
    			<input type="number" name="acThres_on" id="acThres_on" class="form-control" step="0.5" min="10" max="40" value="%acThres_on%">
			</div>
    	</div>
    	
	</form>
	<button id="submitconfig" class="btn btn-primary">Submit</button>
	<div class="inline" id="submitresult"></div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mouse0270-bootstrap-notify/3.1.3/bootstrap-notify.min.js"></script>
	
	<script>
		$(function() {
			$('#submitconfig').on('click', function() {
				$('#submitresult').html()
				
				var querystr = '';
			
				var timearray = $('#form_config [name=tm_led_on]').val().split(':').map(function(s){return Number(s)});
				querystr +=  'tm_led_on=' + (timearray[0]*3600+timearray[1]*60+timearray[2]);
				timearray = $('#form_config [name=tm_led_off]').val().split(':').map(function(s){return Number(s)});
				querystr += '&tm_led_off=' + (timearray[0]*3600+timearray[1]*60+timearray[2]);
				timearray = $('#form_config [name=tm_co2_on]').val().split(':').map(function(s){return Number(s)});
				querystr += '&tm_co2_on=' + (timearray[0]*3600+timearray[1]*60+timearray[2]);
				timearray = $('#form_config [name=tm_co2_off]').val().split(':').map(function(s){return Number(s)});
				querystr += '&tm_co2_off=' + (timearray[0]*3600+timearray[1]*60+timearray[2]);
				timearray = $('#form_config [name=tm_bukubuku_on]').val().split(':').map(function(s){return Number(s)});
				querystr += '&tm_bukubuku_on' + (timearray[0]*3600+timearray[1]*60+timearray[2]);
				timearray = $('#form_config [name=tm_bukubuku_off]').val().split(':').map(function(s){return Number(s)});
				querystr += '&tm_bukubuku_off=' + (timearray[0]*3600+timearray[1]*60+timearray[2]);
				querystr += '&CoolingFANThres_on=' + $('#form_config [name=CoolingFANThres_on]').val();
				querystr += '&CoolingFANThres_off=' + $('#form_config [name=CoolingFANThres_off]').val();
				querystr += '&acThres_on=' + $('#form_config [name=acThres_on]').val();
				if($('#form_config [name=md_led]:checked').val() == "scheduled"){
					querystr += '&md_led=0';
				}else if($('#form_config [name=md_led]:checked').val() == "forcedon"){
					querystr += '&md_led=3';
				}else if($('#form_config [name=md_led]:checked').val() == "forcedoff"){
					querystr += '&md_led=2';
				}
				if($('#form_config [name=md_co2]:checked').val() == "scheduled"){
					querystr += '&md_co2=0';
				}else if($('#form_config [name=md_co2]:checked').val() == "forcedon"){
					querystr += '&md_co2=3';
				}else if($('#form_config [name=md_co2]:checked').val() == "forcedoff"){
					querystr += '&md_co2=2';
				}
				if($('#form_config [name=md_bukubuku]:checked').val() == "scheduled"){
					querystr += '&md_bukubuku=0';
				}else if($('#form_config [name=md_bukubuku]:checked').val() == "forcedon"){
					querystr += '&md_bukubuku=3';
				}else if($('#form_config [name=md_bukubuku]:checked').val() == "forcedoff"){
					querystr += '&md_bukubuku=2';
				}
				if($('#form_config [name=md_CoolingFAN]:checked').val() == "scheduled"){
					querystr += '&md_CoolingFAN=0';
				}else if($('#form_config [name=md_CoolingFAN]:checked').val() == "forcedon"){
					querystr += '&md_CoolingFAN=3';
				}else if($('#form_config [name=md_CoolingFAN]:checked').val() == "forcedoff"){
					querystr += '&md_CoolingFAN=2';
				}
				if($('#form_config [name=md_ac_scheduled]').is(':checked')){
					querystr += '&md_ac=0';			// scheduled off
				}else{
					if($('#form_config [name=acon]').is(':checked')){
						querystr += '&md_ac=3';		// forced on
					}else{
						querystr += '&md_ac=2';		// forced off
					}
				}
				
				console.log(querystr);
				
				$.ajax("/config", {
					type: 'POST',
					data: querystr,
				}).done(function(data){
					$.notify({message: 'Submission success.'},{type: 'success', offset: {x: 20, y:40}});
					console.log(data);
				}).fail(function(XMLHttpRequest, textStatus, errorThrown){
					$.notify({message: 'Submission fail.'},{type: 'warning', offset: {x: 20, y:40}});
					console.log("fail.");
					console.log("XMLHttpRequest : " + XMLHttpRequest.status);
					console.log("textStatus     : " + textStatus);
					console.log("errorThrown    : " + errorThrown.message);
				});
			});
		});
	</script>
  </body>
</html>
